
version: '3'
services:

  cart_ctr:
    build:
      context: cart_ctr
      dockerfile: ./Dockerfile
    hostname: cart_ctr
    expose:
     - "12345"
    ports:
     - "${CART_SERVICE_GRPC_BIND_ADDR?cart_service.grpc.bind_addr must be set by the calling environment}:12345"
    environment:
     - CART_DB_DIAL_ADDR=cart_db_ctr:27017
     - CART_SERVICE_GRPC_BIND_ADDR=0.0.0.0:12345
    restart: always

  cart_db_ctr:
    image: mongo
    hostname: cart_db_ctr
    expose:
     - "27017"
    ports:
     - "${CART_DB_BIND_ADDR?cart_db.bind_addr must be set by the calling environment}:27017"
    restart: always

  catalogue_ctr:
    build:
      context: catalogue_ctr
      dockerfile: ./Dockerfile
    hostname: catalogue_ctr
    expose:
     - "12345"
    ports:
     - "${CATALOGUE_SERVICE_GRPC_BIND_ADDR?catalogue_service.grpc.bind_addr must be set by the calling environment}:12345"
    environment:
     - CATALOGUE_DB_DIAL_ADDR=catalogue_db_ctr:3306
     - CATALOGUE_SERVICE_GRPC_BIND_ADDR=0.0.0.0:12345
    restart: always

  catalogue_db_ctr:
    image: mysql/mysql-server
    hostname: catalogue_db_ctr
    expose:
     - "3306"
    ports:
     - "${CATALOGUE_DB_BIND_ADDR?catalogue_db.bind_addr must be set by the calling environment}:3306"
    environment:
     - MYSQL_ROOT_HOST=%
     - MYSQL_ROOT_PASSWORD=pass
    restart: always

  frontend_ctr:
    build:
      context: frontend_ctr
      dockerfile: ./Dockerfile
    hostname: frontend_ctr
    expose:
     - "2000"
    ports:
     - "${FRONTEND_HTTP_BIND_ADDR?frontend.http.bind_addr must be set by the calling environment}:2000"
    environment:
     - CART_SERVICE_GRPC_DIAL_ADDR=cart_ctr:12345
     - CATALOGUE_SERVICE_GRPC_DIAL_ADDR=catalogue_ctr:12345
     - FRONTEND_HTTP_BIND_ADDR=0.0.0.0:2000
     - ORDER_SERVICE_GRPC_DIAL_ADDR=order_ctr:12345
     - USER_SERVICE_GRPC_DIAL_ADDR=user_ctr:12345
    restart: always

  order_ctr:
    build:
      context: order_ctr
      dockerfile: ./Dockerfile
    hostname: order_ctr
    expose:
     - "12345"
    ports:
     - "${ORDER_SERVICE_GRPC_BIND_ADDR?order_service.grpc.bind_addr must be set by the calling environment}:12345"
    environment:
     - CART_SERVICE_GRPC_DIAL_ADDR=cart_ctr:12345
     - ORDER_DB_DIAL_ADDR=order_db_ctr:27017
     - ORDER_SERVICE_GRPC_BIND_ADDR=0.0.0.0:12345
     - PAYMENT_SERVICE_GRPC_DIAL_ADDR=payment_ctr:12345
     - SHIPPING_SERVICE_GRPC_DIAL_ADDR=shipping_ctr:12345
     - USER_SERVICE_GRPC_DIAL_ADDR=user_ctr:12345
    restart: always

  order_db_ctr:
    image: mongo
    hostname: order_db_ctr
    expose:
     - "27017"
    ports:
     - "${ORDER_DB_BIND_ADDR?order_db.bind_addr must be set by the calling environment}:27017"
    restart: always

  payment_ctr:
    build:
      context: payment_ctr
      dockerfile: ./Dockerfile
    hostname: payment_ctr
    expose:
     - "12345"
    ports:
     - "${PAYMENT_SERVICE_GRPC_BIND_ADDR?payment_service.grpc.bind_addr must be set by the calling environment}:12345"
    environment:
     - PAYMENT_SERVICE_GRPC_BIND_ADDR=0.0.0.0:12345
    restart: always

  shipping_ctr:
    build:
      context: shipping_ctr
      dockerfile: ./Dockerfile
    hostname: shipping_ctr
    expose:
     - "12345"
    ports:
     - "${SHIPPING_SERVICE_GRPC_BIND_ADDR?shipping_service.grpc.bind_addr must be set by the calling environment}:12345"
    environment:
     - SHIPPING_DB_DIAL_ADDR=shipping_db_ctr:27017
     - SHIPPING_SERVICE_GRPC_BIND_ADDR=0.0.0.0:12345
     - SHIPPING_SERVICE_GRPC_DIAL_ADDR=shipping_ctr:12345
    restart: always

  shipping_db_ctr:
    image: mongo
    hostname: shipping_db_ctr
    expose:
     - "27017"
    ports:
     - "${SHIPPING_DB_BIND_ADDR?shipping_db.bind_addr must be set by the calling environment}:27017"
    restart: always

  user_ctr:
    build:
      context: user_ctr
      dockerfile: ./Dockerfile
    hostname: user_ctr
    expose:
     - "12345"
    ports:
     - "${USER_SERVICE_GRPC_BIND_ADDR?user_service.grpc.bind_addr must be set by the calling environment}:12345"
    environment:
     - USER_DB_DIAL_ADDR=user_db_ctr:27017
     - USER_SERVICE_GRPC_BIND_ADDR=0.0.0.0:12345
    restart: always

  user_db_ctr:
    image: mongo
    hostname: user_db_ctr
    expose:
     - "27017"
    ports:
     - "${USER_DB_BIND_ADDR?user_db.bind_addr must be set by the calling environment}:27017"
    restart: always

